import json
import time

from cfg import rpcs


def get_contract_address(token, network):
    pass

def get_gas_price(network='eth_mainnet'):
    gas_price = rpcs[network].eth.gas_price
    return gas_price

def analyze_tx_data(tx_data):
    function = tx_data[:10]
    parameters = tx_data[10:]
    print(function)
    print(len(parameters))
    data = []
    num_params = len(parameters) // 64
    for i in range(num_params):
        print(parameters[i*64:(i+1)*64])
        data.append(parameters[i*64:(i+1)*64])
    return data


def load_json(filename):
    with open(filename, 'r') as f:
        json_file = json.load(f)
    return json_file





def get_accounts():
    accounts_dict = load_json('config/wallet.json')
    accounts = []
    for key, value in accounts_dict.items():
        accounts.append({"address": key, "private_key": value})
    return accounts


def get_ABI_functions(path):
    with open(path, encoding='utf-8', errors='ignore') as json_data:
        contract_abi = json.load(json_data, strict=False)

    function_parameters = {}

    for item in contract_abi:
        if item['type'] == 'function':
            function_name = item['name']
            parameters = []

            for param in item['inputs']:
                param_info = {
                    'name': param['name'],
                    'type': param['type']
                }
                parameters.append(param_info)

            function_parameters[function_name] = parameters

    print("Functions:")
    for function_name, parameters in function_parameters.items():
        print(f"{function_name}:")
        for param in parameters:
            print(f"  {param['name']} ({param['type']})")
def execute_tx(tx, account, rpc):
    signed_txn = rpc.eth.account.sign_transaction(tx, account.private_key)
    print(signed_txn.rawTransaction)
    transaction_hash = rpc.eth.send_raw_transaction(signed_txn.rawTransaction)
    print(f"Transaction hash: {transaction_hash.hex()}")

    success = None
    while True:
        transaction_receipt = rpc.eth.wait_for_transaction_receipt(transaction_hash)
        if transaction_receipt['status'] == 1:
            success = True
            break
        elif transaction_receipt['status'] == 0:
            success = False
            break
        time.sleep(2)

    # Check if the transaction was successful
    if not success:
        print('Transaction failed.')
    else:
        print('Transaction succeeded.')

    return success



if __name__ == '__main__':


    # # data3 = '0x095ea7b3000000000000000000000000b3b7fcbb8db37bc6f572634299a58f51622a847e000000000000000000000000000000000000000000000000000001d1a94a2000'
    # # a = analyze_tx_data(data3)
    # liquidity_data = '0x94ec6d78000000000000000000000000768d6ee2e65b1c4eb948d40a8196bc243bcb967f00000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000161c28a68a8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001a00000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000038d7ea4c68000000000000000000000000000fced12debc831d3a84931c63687c395837d42c2b00000000000000000000000000000000000000000000000000000001eaaea9c20000000000000000000000000000000000000000000000000000000000000020000000000000000000000000dc8d45d062e2fa5cd76b17d24f8691c950d0de580000000000000000000000000000000000000000000000000000000000000000'
    # analyze_tx_data(liquidity_data)
    #
    # data2 = '0x94ec6d78000000000000000000000000768d6ee2e65b1c4eb948d40a8196bc243bcb967f00000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000015fb4dc97c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001a00000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000038d7ea4c68000000000000000000000000000fced12debc831d3a84931c63687c395837d42c2b00000000000000000000000000000000000000000000000000000001dfcde62f0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000dc8d45d062e2fa5cd76b17d24f8691c950d0de580000000000000000000000000000000000000000000000000000000000000000'
    # analyze_tx_data(data2)
    #
    # data3 = '0x94ec6d78000000000000000000000000768d6ee2e65b1c4eb948d40a8196bc243bcb967f00000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001a00000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000038d7ea4c68000000000000000000000000000fced12debc831d3a84931c63687c395837d42c2b00000000000000000000000000000000000000000000000000000001055e316b0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000dc8d45d062e2fa5cd76b17d24f8691c950d0de580000000000000000000000000000000000000000000000000000000000000000'
    # analyze_tx_data(data3)

    # withdraw_data = '0x53c43f15000000000000000000000000768d6ee2e65b1c4eb948d40a8196bc243bcb967f0000000000000000000000000000000000000000000000000000017a44d65e1a00000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000007a1a1144ef79500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000006000000000000000000000000020b28b1e4665fff290650586ad76e977eab90c5d000000000000000000000000dc8d45d062e2fa5cd76b17d24f8691c950d0de5800000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000'
    # analyze_tx_data(withdraw_data)
    #
    # data_4 = '0x53c43f15000000000000000000000000768d6ee2e65b1c4eb948d40a8196bc243bcb967f0000000000000000000000000000000000000000000000000000015cb3b85d8500000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000006e61952307a7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000006000000000000000000000000020b28b1e4665fff290650586ad76e977eab90c5d000000000000000000000000cea3fd38d59ea7c736737848e40555b13a70512500000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000'
    # analyze_tx_data(data_4)


    get_ABI_functions('config/syncswap_pool_abi.json')